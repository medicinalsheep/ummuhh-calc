<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ummuhh-calc</title>
  <style>
    :root {
      --bg: #f8f9fa;
      --text: #212529;
      --display: #343a40;
      --display-text: #fff;
      --btn-bg: #e9ecef;
      --btn-hover: #dee2e6;
      --operator: #fd7e14;
      --equal: #28a745;
      --clear: #dc3545;
      --func: #6f42c1;
    }
    [data-theme="dark"] {
      --bg: #212529;
      --text: #f8f9fa;
      --display: #495057;
      --display-text: #fff;
      --btn-bg: #343a40;
      --btn-hover: #495057;
      --operator: #fd7e14;
      --equal: #2ecc71;
      --clear: #e74c3c;
      --func: #9f7aea;
    }
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      box-sizing: border-box;
    }
    h1 { margin: 0.8rem 0; font-size: 2.1rem; }
    #calculator {
      width: 100%;
      max-width: 400px;
      background: var(--display);
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }
    #display {
      width: 100%;
      height: 80px;
      background: var(--display);
      color: var(--display-text);
      font-size: 2.4rem;
      text-align: right;
      padding: 0 12px;
      border: none;
      border-radius: 8px;
      box-sizing: border-box;
      overflow: hidden;
      white-space: nowrap;
    }
    #expression { font-size: 1.1rem; height: 28px; opacity: 0.8; text-align: right; padding-right: 12px; }
    .buttons {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-top: 1rem;
    }
    button {
      padding: 1.1rem;
      font-size: 1.35rem;
      border: none;
      border-radius: 10px;
      background: var(--btn-bg);
      color: var(--text);
      cursor: pointer;
      transition: all 0.12s;
    }
    button:hover { background: var(--btn-hover); transform: scale(1.04); }
    button.operator { background: var(--operator); color: white; }
    button.func { background: var(--func); color: white; }
    button#equals { background: var(--equal); color: white; /* Removed span 2 to fix layout */ }
    button#clear { background: var(--clear); color: white; }
    #history {
      margin-top: 1.5rem;
      width: 100%;
      max-width: 400px;
      max-height: 200px;
      overflow-y: auto;
      font-size: 0.95rem;
      opacity: 0.9;
      padding: 0.5rem;
      border-radius: 8px;
      background: rgba(0,0,0,0.07);
    }
    #history div { margin: 0.35rem 0; }
    #theme-toggle, #angle-mode {
      position: absolute;
      top: 1rem;
      padding: 0.6rem 1rem;
      font-size: 1rem;
      border-radius: 8px;
    }
    #theme-toggle { right: 1rem; }
    #angle-mode  { right: 110px; background: var(--func); color: white; }
    footer {
      margin-top: auto;
      padding: 1.5rem 0;
      font-size: 0.9rem;
      opacity: 0.7;
      text-align: center;
    }
    @media (max-width: 500px) {
      h1 { font-size: 1.8rem; }
      #display { font-size: 2rem; }
      button { font-size: 1.2rem; padding: 0.9rem; }
    }
  </style>
</head>
<body>

  <button id="theme-toggle">Dark Mode</button>
  <button id="angle-mode">Radians</button>

  <h1>ummuhh-calc</h1>

  <div id="calculator">
    <div id="expression"></div>
    <input type="text" id="display" readonly value="0" aria-label="Calculation result" />
    
    <div class="buttons">
      <!-- Row 1 -->
      <button class="func" onclick="append('sin(')">sin</button>
      <button class="func" onclick="append('cos(')">cos</button>
      <button class="func" onclick="append('tan(')">tan</button>
      <button class="func" onclick="append('log(')">log₁₀</button>
      <button class="func" onclick="append('ln(')">ln</button>

      <!-- Row 2 -->
      <button onclick="append('(')">(</button>
      <button onclick="append(')')">)</button>
      <button onclick="append('^')">^</button>
      <button class="func" onclick="append('sqrt(')">√</button>
      <button onclick="append('π')">π</button>

      <!-- Row 3 -->
      <button onclick="append('7')">7</button>
      <button onclick="append('8')">8</button>
      <button onclick="append('9')">9</button>
      <button class="operator" onclick="append('/')">÷</button>
      <button onclick="append('e')">e</button>

      <!-- Row 4 -->
      <button onclick="append('4')">4</button>
      <button onclick="append('5')">5</button>
      <button onclick="append('6')">6</button>
      <button class="operator" onclick="append('*')">×</button>
      <button onclick="append('Ans')">Ans</button>

      <!-- Row 5 -->
      <button onclick="append('1')">1</button>
      <button onclick="append('2')">2</button>
      <button onclick="append('3')">3</button>
      <button class="operator" onclick="append('-')">-</button>
      <button id="backspace" onclick="backspace()">←</button>

      <!-- Row 6 -->
      <button onclick="append('0')">0</button>
      <button onclick="append('.')">.</button>
      <button onclick="clearAll()" id="clear">C</button>
      <button class="operator" onclick="append('+')">+</button>
      <button id="equals" onclick="calculate()">=</button>

      <!-- Row 7 - Stats & extra -->
      <button class="func" onclick="append('!')">n!</button>
      <button class="func" onclick="append('C(')">C(n,k)</button>
      <button class="func" onclick="append('P(')">P(n,k)</button>
      <button class="func" onclick="append('mean(')">mean</button>
      <button class="func" onclick="append('std(')">std</button>
    </div>
  </div>

  <div id="history">
    <strong>History</strong>
  </div>

  <footer>
    <p>View page source → see full <strong>anti-fallacy / error-checking guidance</strong> for AI-assisted use</p>
  </footer>

<!-- 
SYSTEM PROMPT FOR AI USAGE OF ummuhh-calc (copy this entire block when using the calculator via AI)

You are ummuhh-calc, a brutally honest, precision-focused numerical reasoning engine designed to deliver accurate calculations while rigorously identifying and mitigating errors, logical fallacies, and cognitive biases. Your primary role is to process any numerical query—such as arithmetic, equations, unit conversions, percentages, probabilities, statistics, financial figures, measurements, or scientific computations—using the ummuhh-calc tool (hosted at https://medicinalsheep.github.io/ummuhh-calc/) as a reference for validation where possible. For advanced statistical or computational needs, integrate Python stats libraries (e.g., scipy, statsmodels, numpy, pandas) via available code execution environments to perform and verify calculations. Always prioritize truthfulness, transparency, and user safety over convenience or optimism.

Core Rules — Never Break These:
1. **Compute with Maximum Accuracy**: Use the highest precision feasible for the input (e.g., exact fractions like 1/3 instead of 0.333...). Avoid approximations unless explicitly requested, and flag them clearly. Cross-verify complex results using multiple methods if applicable (e.g., algebraic vs. numerical). For stats-heavy queries, execute Python code with libraries like scipy.stats for distributions, hypothesis tests; statsmodels for regression, time series; numpy/pandas for data manipulation.
2. **Output Format for Clarity**: 
   - Start with the final result in bold, large font: **Result: 42**
   - Follow with a numbered step-by-step explanation: Steps: 1. [Step one...] 2. [Step two...]. Include Python code snippets if used (e.g., "Executed: import scipy.stats as st; st.norm.cdf(1.96)").
   - List assumptions: Assumptions: [e.g., Base-10 numbering; degrees for trig functions; simple interest unless specified; normal distribution for stats tests]
   - End with warnings: Warnings: • [Error/fallacy 1] • [Error/fallacy 2]
3. **State All Assumptions Explicitly**: Detail every implicit choice (e.g., radians vs. degrees in trig; population vs. sample standard deviation; compounding frequency in finance; significant figures from input; alpha=0.05 for hypothesis tests in Python).
4. **Flag Every Plausible Error, Fallacy, or Logical Pitfall**: Systematically check and highlight common issues. For each query, review this list and include relevant flags with brief explanations. If none apply, state "No major errors/fallacies detected." Categories include:
   - **Mathematical Errors**: Division by zero/near-zero (instability warning); floating-point precision loss (e.g., warn if >4-5 decimals are critical; use mpmath for high precision in Python); spurious precision (don't report 10 decimals on 2-sig-fig input); unit mismatches (e.g., adding meters to kilograms); rounding artifacts; overflow/underflow in large/small numbers.
   - **Statistical Fallacies**: Correlation vs. causation (e.g., "High correlation between ice cream sales and drownings doesn't imply causation—likely confounded by summer heat"); base-rate neglect (ignoring prevalence, e.g., in probability tests); gambler's fallacy (expecting 'due' outcomes in independent events); hot-hand fallacy (perceiving streaks in random data); small sample overconfidence (n<30 is risky; e.g., "With only 5 data points, this mean is unreliable—confidence interval too wide; use scipy.stats.t.interval for CI"); Simpson's paradox (aggregated data hides subgroup trends; check with pandas groupby); multiple comparisons/p-hacking (testing many hypotheses inflates false positives; adjust with statsmodels.stats.multitest); overfitting (model too tailored to sample data; validate with cross-validation in statsmodels); extrapolation errors (predicting beyond data range).
   - **Cognitive/Logical Biases**: Availability heuristic (overestimating risks from vivid examples, e.g., plane crashes vs. car accidents); survivorship bias (e.g., in finance: "Successful companies' traits ignore failed ones"); confirmation bias (cherry-picking data); anchoring (over-relying on initial numbers); absolute vs. relative confusion (e.g., "A 50% increase from 2 to 3 is small absolutely"); percentage-point vs. percent mix-up (e.g., "Interest rate from 3% to 4% is a 1 percentage-point rise, but ~33% relative increase").
   - **Real-World Misinterpretation Risks**: For sensitive contexts (money, medicine, voting, risk), add a dedicated warning: "In real-world context [X], this number can be dangerous if used [Y] way—e.g., in medicine, misapplying dosage calculations could harm health; consult experts."
5. **Handle Ambiguity**: If input is unclear (e.g., missing units, vague terms), ask clarifying questions instead of guessing. Do not proceed with assumptions without flagging them.
6. **Provide Alternatives/Sensitivity Analysis**: Where relevant, show variations (e.g., "If monthly compounding: 5.12%; annual: 5%"; "At 90% CI: [lower-upper]; at 95%: wider range—computed via scipy.stats.norm.interval").
7. **Never Deceive**: Do not add fake precision, exaggerate certainty, or omit limitations. If exact computation is impossible, say so (e.g., "Irrational number—approximated to 10 decimals via mpmath").
8. **Integration with Tool and Python**: Reference the ummuhh-calc web app for manual verification. If the query aligns with its functions (e.g., trig, stats), simulate or describe using it. For advanced stats beyond basic (e.g., ANOVA, regression, distributions), use Python code execution with relevant libraries:
   - Import and use: e.g., "import numpy as np; import scipy.stats as st; import statsmodels.api as sm; import pandas as pd"
   - Handle data: Use pandas for datasets, numpy for arrays.
   - Verify: Always run code to confirm results, flag if library assumptions (e.g., normality in t-tests) are violated (use st.shapiro for normality test).

Included Examples and Patterns Reflecting Fallacies, Errors, or Loss of Logic:
To illustrate, here are patterned examples of common pitfalls—use these as templates to detect and explain similar issues in queries. Integrate Python where it enhances accuracy or fallacy detection:

- **Pattern: Division Instability Example**: Query: "1 / (0.000001)". Response: **Result: 1000000**. Steps: 1. Direct division (verified in Python: 1 / 1e-6). Assumptions: Exact arithmetic. Warnings: • Near-zero division—small changes in denominator could drastically alter result (instability); in floating-point, precision loss possible (numpy shows same).

- **Pattern: Correlation/Causation Fallacy Example**: Query: "Correlation of 0.9 between variable A and B". Response: **Result: Strong positive correlation (r=0.9)**. Steps: 1. Computed Pearson coefficient (via st.pearsonr(A, B)). Assumptions: Linear relationship; sample data. Warnings: • Correlation ≠ causation—could be confounding factors (e.g., C causes both); check for spurious links like 'number of Nicolas Cage movies and swimming pool drownings'; use statsmodels to regress with controls.

- **Pattern: Small Sample Overconfidence Example**: Query: "Mean of [1,3,5]". Response: **Result: 3**. Steps: 1. Sum/3 (np.mean([1,3,5])). Assumptions: Arithmetic mean. Warnings: • Small sample (n=3)—high variance; overconfidence fallacy: Don't generalize to population without larger n (e.g., std dev=2 via np.std, CI wide via st.t.interval).

- **Pattern: Base-Rate Neglect Example**: Query: "Test is 99% accurate; 1% disease prevalence; positive result—probability of disease?". Response: **Result: ~50% (Bayes' theorem)**. Steps: 1. P(D|T+) = (0.99*0.01) / [(0.99*0.01) + (0.01*0.99)] (computed via custom Python function). Assumptions: Independent test. Warnings: • Base-rate fallacy: Ignoring 1% prevalence leads to overestimating (many think 99%); real-world: In low-prevalence screening, false positives dominate.

- **Pattern: Survivorship Bias Example**: Query: "Average return of top 10 stocks over 10 years". Response: **Result: 15% annualized**. Steps: 1. Geometric mean (np.prod(returns)**(1/len(returns)) - 1). Assumptions: Historical data. Warnings: • Survivorship bias—excludes failed stocks; full market average might be lower (e.g., many bankruptcies ignored); use pandas to filter complete datasets.

- **Pattern: Unit Mismatch Error Example**: Query: "Speed: 60 km/h + 30 m/s". Response: **Result: Cannot compute directly**. Steps: N/A. Assumptions: None. Warnings: • Unit error—convert first (30 m/s = 108 km/h via Python: 30 * 3.6); mismatch causes dimensional inconsistency (logical failure in physics/engineering).

- **Pattern: Gambler's Fallacy Example**: Query: "Coin flipped heads 5 times—next tails probability?". Response: **Result: 50%**. Steps: 1. Independent events (simulated via np.random.binomial). Assumptions: Fair coin. Warnings: • Gambler's fallacy—past outcomes don't influence future; no 'due' correction in random processes.

- **Pattern: Extrapolation Risk Example**: Query: "Linear trend: y=2x; predict at x=100". Response: **Result: 200**. Steps: 1. Plug in (via sm.OLS for model: model.predict(100)). Assumptions: Model holds. Warnings: • Extrapolation fallacy—beyond data range (e.g., if trained on x=1-10), real trends may curve; potential for massive error; check residuals with statsmodels.

- **Pattern: P-Hacking/Multiple Comparisons Example**: Query: "Run 20 t-tests on dataset; report significant ones". Response: **Result: [List p-values]**. Steps: 1. Executed multiple st.ttest_ind. Assumptions: Independent samples. Warnings: • Multiple comparisons fallacy/p-hacking—inflates Type I errors (expected ~1 false positive at alpha=0.05); adjust with statsmodels.stats.multitest.fdrcorrection for FDR control.

- **Pattern: Overfitting in Regression Example**: Query: "Fit polynomial to noisy data". Response: **Result: Coefficients [a,b,c]**. Steps: 1. Used np.polyfit(degree=5). Assumptions: Polynomial model. Warnings: • Overfitting—high-degree fits noise, not signal; poor generalization (validate with train-test split via pandas/sklearn if available, or cross_val_score in statsmodels).

This calculator lives at: https://medicinalsheep.github.io/ummuhh-calc/
Use this prompt + the live calculator page together to give truthful, fallacy-resistant numerical answers. Always reference these examples when a query matches a pattern to educate the user on avoidance. For Python integration, assume a code execution tool is available; if not, fall back to manual computation.
-->

  <script>
    const display = document.getElementById('display');
    const exprLine = document.getElementById('expression');
    const historyDiv = document.getElementById('history');
    let current = '0';
    let expression = '';
    let lastResult = null;
    const MAX_HISTORY = 12;

    // Theme
    const themeToggle = document.getElementById('theme-toggle');
    if (localStorage.getItem('theme') === 'dark') {
      document.documentElement.setAttribute('data-theme', 'dark');
      themeToggle.textContent = 'Light Mode';
    }
    themeToggle.onclick = () => {
      if (document.documentElement.getAttribute('data-theme') === 'dark') {
        document.documentElement.removeAttribute('data-theme');
        themeToggle.textContent = 'Dark Mode';
        localStorage.setItem('theme', 'light');
      } else {
        document.documentElement.setAttribute('data-theme', 'dark');
        themeToggle.textContent = 'Light Mode';
        localStorage.setItem('theme', 'dark');
      }
    };

    // Angle mode
    const angleBtn = document.getElementById('angle-mode');
    let radians = localStorage.getItem('angleMode') !== 'degrees';
    angleBtn.textContent = radians ? 'Radians' : 'Degrees';
    angleBtn.onclick = () => {
      radians = !radians;
      angleBtn.textContent = radians ? 'Radians' : 'Degrees';
      localStorage.setItem('angleMode', radians ? 'radians' : 'degrees');
    };

    function updateDisplay() {
      display.value = current || '0';
      exprLine.textContent = expression || '';
    }

    function append(val) {
      if (current === '0' && !['+', '-', '*', '/', '^', ')', '!'].includes(val)) {
        current = val;
      } else {
        current += val;
      }
      expression += val;
      updateDisplay();
    }

    function clearAll() {
      current = '0';
      expression = '';
      updateDisplay();
    }

    function backspace() {
      if (current.length > 1) current = current.slice(0, -1);
      else current = '0';
      if (expression.length > 0) expression = expression.slice(0, -1);
      updateDisplay();
    }

    function factorial(n) {
      if (!Number.isInteger(n) || n < 0) throw new Error("n! requires non-negative integer");
      if (n > 170) throw new Error("n! too large");
      let res = 1;
      for (let i = 2; i <= n; i++) res *= i;
      return res;
    }

    function combination(n, k) {
      if (k < 0 || k > n) return 0;
      if (!Number.isInteger(n) || !Number.isInteger(k)) throw new Error("C(n,k) needs integers");
      return factorial(n) / (factorial(k) * factorial(n - k));
    }

    function permutation(n, k) {
      if (k < 0 || k > n) return 0;
      if (!Number.isInteger(n) || !Number.isInteger(k)) throw new Error("P(n,k) needs integers");
      return factorial(n) / factorial(n - k);
    }

    function mean(numbers) {
      if (numbers.length === 0) throw new Error("mean of empty list");
      return numbers.reduce((a, b) => a + b, 0) / numbers.length;
    }

    function variance(numbers) {
      if (numbers.length <= 1) throw new Error("variance needs ≥2 values");
      const m = mean(numbers);
      return numbers.reduce((a, b) => a + (b - m) ** 2, 0) / (numbers.length - 1);
    }

    function stdDev(numbers) {
      return Math.sqrt(variance(numbers));
    }

    function parseArgList(argStr) {
      return argStr.split(',').map(s => {
        const t = s.trim();
        return isNaN(t) ? NaN : Number(t);
      }).filter(n => !isNaN(n));
    }

    function calculate() {
      try {
        let evalExpr = expression
          .replace(/π/g, 'Math.PI')
          .replace(/e/g, 'Math.E')
          .replace(/\^/g, '**')
          .replace(/sqrt\(/g, 'Math.sqrt(')
          .replace(/log\(/g, 'Math.log10(')
          .replace(/ln\(/g, 'Math.log(')
          .replace(/!/g, '') // we'll handle factorial separately
          .replace(/C\(/g, 'combination(')
          .replace(/P\(/g, 'permutation(')
          .replace(/mean\(/g, 'mean([')
          .replace(/std\(/g, 'stdDev([');

        // Close any open stats arrays
        if (evalExpr.includes('mean([') || evalExpr.includes('stdDev([')) {
          evalExpr = evalExpr.replace(/(\)|\s*$)/, ']) $1');
        }

        // Angle conversion
        const toRad = radians ? '' : ' * Math.PI / 180';
        evalExpr = evalExpr
          .replace(/Math\.sin\(/g, `Math.sin(${toRad}`)
          .replace(/Math\.cos\(/g, `Math.cos(${toRad}`)
          .replace(/Math\.tan\(/g, `Math.tan(${toRad}`);

        // Replace Ans
        evalExpr = evalExpr.replace(/Ans/g, lastResult !== null ? lastResult : '0');

        // Basic sanitization
        if (/[^\d\s\+\-\*\/\(\)\.\^eπ√logln!Cmeanstd(),]/.test(expression)) {
          throw new Error("Invalid characters");
        }

        // Custom functions need to be in scope
        const result = eval(`
          (function() {
            function factorial(n){${factorial.toString().slice(13)}}
            function combination(n,k){${combination.toString().slice(13)}}
            function permutation(n,k){${permutation.toString().slice(13)}}
            function mean(arr){${mean.toString().slice(13)}}
            function variance(arr){${variance.toString().slice(13)}}
            function stdDev(arr){${stdDev.toString().slice(13)}}
            return ${evalExpr};
          })()
        `);

        const nice = Number.isInteger(result) ? result : Number(result.toFixed(10));
        current = nice.toString();
        lastResult = nice;

        addToHistory(`${expression} = ${nice}`);
        expression = current;
        updateDisplay();
      } catch (err) {
        current = 'Error: ' + err.message.slice(0, 40);
        addToHistory(`${expression} → ${current}`);
        updateDisplay();
        setTimeout(() => { clearAll(); }, 2200);
      }
    }

    function addToHistory(entry) {
      const div = document.createElement('div');
      div.textContent = entry;
      historyDiv.appendChild(div);
      if (historyDiv.children.length > MAX_HISTORY + 1) {
        historyDiv.removeChild(historyDiv.children[1]);
      }
      historyDiv.scrollTop = historyDiv.scrollHeight;
    }

    // Keyboard
    document.addEventListener('keydown', e => {
      if (e.key >= '0' && e.key <= '9' || e.key === '.') append(e.key);
      if (e.key === '+') append('+');
      if (e.key === '-') append('-');
      if (e.key === '*') append('*');
      if (e.key === '/') append('/');
      if (e.key === 'Enter' || e.key === '=') { e.preventDefault(); calculate(); }
      if (e.key === 'Backspace') backspace();
      if (e.key === 'Escape') clearAll();
      if (e.key === '^') append('^');
      if (e.key === '(') append('(');
      if (e.key === ')') append(')');
    });

    updateDisplay();
  </script>
</body>
</html>
